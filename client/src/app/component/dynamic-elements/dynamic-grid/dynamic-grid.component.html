<div #container class="position-relative">

  <div class="position-absolute columns-dropdown">
    <app-column-chooser [columns]="columns" [isKendoGrid]="false" (outputHiddenColumns)="onOutputHiddenColumns($event)"
      [type]="type"></app-column-chooser>
  </div>

  <ejs-grid #grid *ngIf="config" width="100%" [height]="config.height ? config.height : height" [dataSource]="data"
    [editSettings]="config.editSettings" [toolbar]="config.toolbar" [allowSorting]="config?.sorting?.enable"
    [sortSettings]="config?.sorting?.initialSorting" [allowGrouping]="config.grouping.enable"
    [allowResizing]="config.allowResizing" [allowPaging]="config.paging.enable" [pageSettings]="config.paging.settings"
    [allowFiltering]="config.filtering.enable" [textWrapSettings]='config.wrapSettings'
    (actionBegin)="actionBegin($event)" (actionComplete)="actionComplete($event)" (toolbarClick)="clickHandler($event)">
    <e-columns>
      <e-column *ngFor="let item of config.columns; let i = index" [type]="item.type" [field]="item.field"
        [headerText]="language[item.title] ? language[item.title] : item.title" [width]="item.width"
        [class]="item?.class" [textAlign]="item?.position" [isPrimaryKey]="item.isPrimaryKey"
        [editType]="item.editType ? item.editType : null" [allowEditing]="item.allowEditing" [format]="item.format"
        [validationRules]="item.validation">
        <ng-template *ngIf="item?.type == 'documentPreview'" class="item?.position" #template let-data>
          <div>
            <button kendoButton [icon]="'k-icon k-i-preview'" class="k-preview"
              (click)="previewDocument(data.filename)">
              <span *ngIf="item.classIcon" class="item.classIcon"></span>
            </button>
          </div>
        </ng-template>
        <ng-template *ngIf="item?.type == 'button'" class="item?.position" #template let-data>
          <button *ngIf="item?.mode === 'action'" kendoButton [class]="item?.class"
            (click)="action(data, item.mode, item)">
            <span *ngIf="item.classIcon" class="{{ item.classIcon }} mr-2"></span>
            {{ language[item?.label] ? language[item?.label] : item?.label }}
          </button>
        </ng-template>
        <ng-template *ngIf="item?.type == 'detailsButton'" class="item?.position" #template let-data>
          <button class="detailsButton-button" (click)="openClinicDetail(data.id)">
            Details
          </button>
        </ng-template>
        <ng-template #template let-data *ngIf="item.template">
          <div *ngIf="item.template.choices">
            <div *ngFor="let item of item.template.choices">
              <div *ngIf="
                  item.operator === '==' && data[item.field] === item.value
                " [innerHtml]="item.html"></div>
              <div *ngIf="
                  item.operator === '!=' && data[item.field] !== item.value
                " [innerHtml]="item.html"></div>
              <div *ngIf="item.operator === '>' && data[item.field] > item.value" [innerHtml]="item.html"></div>
              <div *ngIf="item.operator === '>' && data[item.field] < item.value" [innerHtml]="item.html"></div>
            </div>
          </div>
        </ng-template>
      </e-column>
    </e-columns>

    <ejs-dialog #mailTemplate [visible]='false' width="400px" height="440px" [target]='targetElement'>
      <form [formGroup]="mailGroup">
        <label *ngIf="emailsForSendingMessage.length < 1" style="color:red; display: block;"> {{
          language.noClinicSelected }} </label>
        {{ language.emailSubject }}
        <input class="e-input" type="text" placeholder="{{ language.emailSubject }}" formControlName="subject" />
        <hr>
        {{ language.mailMessage }}
        <textarea cols="45" rows="10" class="text-area" placeholder="{{ language.inputEmailMessage }}"
          formControlName="message"></textarea>
      </form>
      <ng-template #footerTemplate>
        <button id="cancelButton" (click)="mailTemplate.hide()" class="e-control e-btn e-primary cancelButton">{{
          language.cancel }}</button>
        <button id="sendButton" [disabled]="emailsForSendingMessage.length < 1" (click)="sendEmail()"
          class="e-control e-btn e-primary sendButton">{{ language.sendPatientFormButton }}</button>
      </ng-template>
    </ejs-dialog>

    <ng-template #editSettingsTemplate let-data>
      <div ngForm #orderForm="ngForm" style="max-height: 70% !important">
        <div class="form-row">
          <app-dynamic-forms [config]="{config: config.configField}" (submit)="submitEmitter($event)"
            (isFormDirtyChange)="setDirtyForm($event)" #form="dynamicForm">
          </app-dynamic-forms>

          <app-dynamic-confirm-dialog [showDialog]="showDialog" [title]="language?.changesWontBeSavedTitle"
            [question]="language?.changesWontBeSaved" (sendEmitter)="receiveConfirm($event)">
          </app-dynamic-confirm-dialog>
        </div>
      </div>
    </ng-template>
  </ejs-grid>
</div>